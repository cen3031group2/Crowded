<!DOCTYPE html>
<!-- this is crowdy's html file. woohoo. -->
<!-- 10/11/18-->

  <!--Original HTML Below-->
  <html>

  <head>
    <title>Crowdy</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles/main.css">
  </head>

  <body>
    <img src="images\Crowdy_Concept.png" alt="Crowdy">
    <div align="right">
      <a href="loginForm.html"><button type="button" class="btn btn-info" id="login-button">Login</button></a>
    </div>
    <!-- Header -->
    <h1 align="center" margin-left="">
      <div id="title">Welcome to Crowdy!<br></div>
    </h1>

    <div id="floating-panel">
      <input onclick="closestCinema();" type=button value="Show Closest Cinema">
      <input onclick="nonCrowdyCinema();" type=button value="Show Least Crowdiest Cinema">
      <input onclick="crowdyCinema();" type=button value="Show Most Crowdiest Cinema">
      <input onclick="resetMap();" type=button value="Reset Map">
    </div>

    <!-- map element -->
    <div id="map"></div>
    <script>
      var map;
      var infowindow;
      var pos;
      var markers = [];
      var usrMarker;

      function initMap() {
        var gainesville = {
          lat: 29.6456,
          lng: -82.3800
        };
        var image = "images/video-camera.png";
        var contentString1 = '<div id="content">'+
            '<div id="siteNotice">'+
            '</div>'+
            '<h1 id="firstHeading" class="firstHeading">Regal Butler Town Center 14</h1>'+
            '<div id="bodyContent" align="center">'+
            '<p>(844) 462-7342 ext 185<br>' +
            '3101 SW 35th Blvd, Gainesville, FL 32608, United States<br>'+
            '<a href="http://www.regmovies.com/theaters/regal-butler-town-center-14/1833">'+
            'http://www.regmovies.com/theaters/regal-butler-town-center-14/1833</a>'+
            '</p>'+
            '</div>'+
            '</div>';
        var contentString2 = '<div id="content">'+
            '<div id="siteNotice">'+
            '</div>'+
            '<h1 id="firstHeading" class="firstHeading">Regal Royal Park Stadium 16</h1>'+
            '<div id="bodyContent" align="center">'+
            '<p>(844) 462-7342 ext 1308<br>' +
            '3702 W Newberry Rd, Gainesville, FL 32607, United States<br>'+
            '<a href="http://www.regmovies.com/theaters/regal-royal-park-stadium-16/6955">'+
            'http://www.regmovies.com/theaters/regal-royal-park-stadium-16/6955</a>'+
            '</p>'+
            '</div>'+
            '</div>';
          var contentString3 = '<div id="content">'+
              '<div id="siteNotice">'+
              '</div>'+
              '<h1 id="firstHeading" class="firstHeading">Regal Celebration Pointe 10</h1>'+
              '<div id="bodyContent" align="center">'+
              '<p>(352) 373-2880<br>' +
              '4901 Southwest 31st Place Gainesville, FL 32608, United States<br>'+
              '<a href="http://www.regmovies.com/theaters/regal-celebration-pointe-10-rpx/47521">'+
              'http://www.regmovies.com/theaters/regal-celebration-pointe-10-rpx/47521</a>'+
              '</p>'+
              '</div>'+
              '</div>';
        map = new google.maps.Map(document.getElementById('map'), {
          center: gainesville,
          zoom: 13.5
        });
        var infowindow1 = new google.maps.InfoWindow({
          content: contentString1
        });
        var infowindow2 = new google.maps.InfoWindow({
          content: contentString2
        });
        var infowindow3 = new google.maps.InfoWindow({
          content: contentString3
        });
        var regal14 = {lat: 29.627376, lng: -82.377151};
        var marker1 = new google.maps.Marker({
          position: regal14,
          map: map,
          title: 'Regal Butler Town Center 14',
          icon: image,
          animation: google.maps.Animation.DROP
        });
        var regal16 = {lat: 29.653878, lng: -82.380191};
        var marker2 = new google.maps.Marker({
          position: regal16,
          map: map,
          title: 'Regal Royal Park Stadium 16',
          icon: image,
          animation: google.maps.Animation.DROP
        });
        var regal10 = {lat: 29.6236, lng: -82.3951};
        var marker3 = new google.maps.Marker({
          position: regal10,
          map: map,
          title: 'Regal Celebration Pointe 10',
          icon: image,
          animation: google.maps.Animation.DROP
        });

        markers.push(marker1);
        markers.push(marker2);
        markers.push(marker3);

        marker1.addListener('click', function() {
           map.setZoom(16);
           map.setCenter(marker1.getPosition());
           infowindow1.open(map, marker1);
        });
        marker2.addListener('click', function() {
           map.setZoom(16);
           map.setCenter(marker2.getPosition());
           infowindow2.open(map, marker2);
        });
        marker3.addListener('click', function() {
           map.setZoom(16);
           map.setCenter(marker3.getPosition());
           infowindow3.open(map, marker3);
        });

        infoWindow = new google.maps.InfoWindow;

        if (navigator.geolocation) {

         navigator.geolocation.getCurrentPosition(function(position) {
           var userPos = {
             lat: position.coords.latitude,
             lng: position.coords.longitude
           };

          infoWindow.setPosition(userPos);
          usrMarker = new google.maps.Marker({
            position: userPos,
            map: map,
            title: 'YOU ARE HERE',
            animation: google.maps.Animation.DROP
          });

           }, function() {
             handleGeoLocationError(true, infoWindow, map.getCenter());
           });
         } else {
            handleGeoLocationError(false, infoWindow, map.getCenter());
     }

     function handleGeoLocationError(geoAvailable, infoWindow, pos) {
       infoWindow.setPosition(pos);
       infoWindow.setContent(geoAvailable ?
                           'Error: Geolocation has failed' :
                           'Error: No Geolocation available on your machine');
       infoWindow.open(map);
     }
    }

    function closestCinema () {
      var shortest = 0;
      var shortestCalculation = google.maps.geometry.spherical.computeDistanceBetween(markers[0].getPosition(), usrMarker.getPosition());;

      for (var i = 3; i < 6; ++i) {
        var compute = google.maps.geometry.spherical.computeDistanceBetween(markers[i].getPosition(), usrMarker.getPosition());
        if (compute < shortestCalculation) {
          shortest = i;
          shortestCalculation = compute;
        }
      }

      console.log (shortest);

      for (var i = 3; i < 6; ++i) {
        if (i != shortest)
          markers[i].setMap(null);
      }
    }

    function resetMap () {
      for (var i = 3; i < 6; ++i)
          markers[i].setMap(map);
    }

    function nonCrowdyCinema() {
      var smallest = 0;
      var smallestCalculation;
      $.getJSON("/api/theater/getAllTheaters", function( data ) {
        console.log(data);
        smallestCalculation = data[0].crowdy.public + data[0].crowdy.employee / 2;
        for (var i = 0; i < data.length; ++i) {
          var tempCalc = data[i].crowdy.public + data[i].crowdy.employee / 2;
          if (tempCalc < smallestCalculation) {
            smallest = i;
            smallestCalculation = tempCalc;
          }
        }
      });

      console.log (smallest);

      for (var i = 3; i < 6; ++i) {
          if (i - 3 != smallest)
          markers[i].setMap(null);
        }
    }

    function crowdyCinema() {
      var largest = 0;
      var largestCalculation;
      $.getJSON("/api/theater/getAllTheaters", function( data ) {
        console.log(data);
        largestCalculation = data[0].crowdy.public + data[0].crowdy.employee / 2;
        for (var i = 0; i < data.length; ++i) {
          var tempCalc = data[i].crowdy.public + data[i].crowdy.employee / 2;
          if (tempCalc > largestCalculation) {
            largest = i;
            largestCalculation = tempCalc;
          }
        }
      });

      console.log (largest);

      for (var i = 3; i < 6; ++i) {
          if (i - 3 != largest)
          markers[i].setMap(null);
        }
    }


    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBJT8tEpxqhEBNdkmalgH3w4VNVnX8hOTA&callback=initMap" async defer></script>
    <script src="https://maps.googleapis.com/maps/api/js?libraries=geometry,places&key=AIzaSyBJT8tEpxqhEBNdkmalgH3w4VNVnX8hOTA&callback=initMap" async defer></script>
    <!-- end map element -->

    <div class="form-group">
      <label class="col-md-4 control-label" for="singlebutton"></label>
      <div class="col-md-4 text-center">
        <!-- <div class="bottomTabs"> -->

        <!-- cinema and movies tabs -->
        <ul id="bottomButtons">
          <li><a class="active" href="./index.html">Show Cinemas</a></li>
          <li ng-controller="MovieController" ng-click="getMoviesFromTheater()"><a href="./crowdy2.html">Show Movies</a></li>
        </ul>
      <!-- </div> -->
      </div>
    </div>

  </body>

  </html>

  <!--<script type="text/javascript" src="./js/app.js"></script>-->

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
